{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Pesquisar Dívidas</title>
  <link rel="stylesheet" href="{% static 'css/divida/pesquisar_divida.css' %}">
</head>
<body>
  <div class="container">
    <h1>Pesquisar Dívidas</h1>
    <form method="get" action="{% url 'pesquisar_divida' %}">
      {% csrf_token %}
      <label for="cpf_cliente">CPF do Cliente</label>
      <input type="text" id="cpf_cliente" name="cpf_cliente" value="{{ request.GET.cpf_cliente }}" placeholder="Ex: 12345678901">

      <label for="status">Status</label>
      <select id="status" name="status">
        <option value="">-- Todos --</option>
        <option value="Pendente" {% if request.GET.status == "Pendente" %}selected{% endif %}>Pendente</option>
        <option value="Pago" {% if request.GET.status == "Pago" %}selected{% endif %}>Pago</option>
        <option value="Parcial" {% if request.GET.status == "Parcial" %}selected{% endif %}>Parcial</option>
        <option value="Cancelado" {% if request.GET.status == "Cancelado" %}selected{% endif %}>Cancelado</option>
      </select>

      <div style="display: flex; gap: 10px;">
        <div style="flex: 1;">
          <label for="valor_min">Valor mínimo (R$)</label>
          <input type="number" id="valor_min" name="valor_min" value="{{ request.GET.valor_min }}" min="0" step="0.01">
        </div>
        <div style="flex: 1;">
          <label for="valor_max">Valor máximo (R$)</label>
          <input type="number" id="valor_max" name="valor_max" value="{{ request.GET.valor_max }}" min="0" step="0.01">
        </div>
      </div>

      <button type="submit">Pesquisar</button>
    </form>
    {% if messages %}
      {% for msg in messages %}
        <div class="success">{{ msg }}</div>
      {% endfor %}
    {% endif %}

    {% if dividas %}
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>CPF Funcionário</th>
            <th>Valor (R$)</th>
            <th>Status</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          {% for d in dividas %}
            <tr>
              <td>{{ d.cod_divida }}</td>
              <td>{{ d.cliente }}</td>
              <td>{{ d.cpf_funcionario }}</td>
              <td>{{ d.valor }}</td>
              <td>{{ d.status }}</td>
              <td>{{ d.data_divida|date:"d/m/Y" }}</td>
              <td><button><a href="{% url 'atualizar_divida' d.cod_divida %}" class="btn">Editar</a></button></td>
              <td><form method="post" action="{% url 'excluir_divida' d.cod_divida %}">
                {% csrf_token %}
                <button type="submit" name="excluir">Excluir</button>
              </form></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="no-results">Nenhuma dívida encontrada com os filtros informados.</p>
    {% endif %}
  </div>
</body>
</html>